{% extends 'base.html' %}

{% block title %}Ver Turno - ServiHogar{% endblock %}

{% block content %}
<div class="page-container">
    <div class="card-turno-detalle estado-{{ turno.estado }}">
        <div class="turno-header">
            <h1>Turno #{{ turno.id }}</h1>
            <span class="badge badge-{{ turno.estado }}">{{ turno.get_estado_display }}</span>
        </div>
        
        <div class="turno-detalle">
            <section>
                <h2>Información del Servicio</h2>
                <p><strong>Servicio:</strong> {{ turno.servicio.nombre }}</p>
                <p><strong>Categoría:</strong> {{ turno.servicio.categoria.nombre }}</p>
                <p><strong>Descripción:</strong> {{ turno.servicio.descripcion }}</p>
            </section>
            
            <section>
                <h2>Fecha y Ubicación</h2>
                <p><strong>Fecha y Hora:</strong> {{ turno.fecha_hora|date:"d/m/Y H:i" }}</p>
                <p><strong>Dirección:</strong> {{ turno.direccion_servicio }}</p>
                {% if turno.observaciones %}
                    <p><strong>Observaciones:</strong> {{ turno.observaciones }}</p>
                {% endif %}
            </section>
            
            <section>
                <h2>Cliente</h2>
                <p><strong>Nombre:</strong> {{ turno.cliente.usuario.get_full_name }}</p>
                <p><strong>Email:</strong> {{ turno.cliente.usuario.email }}</p>
                <p><strong>Teléfono:</strong> {{ turno.cliente.usuario.telefono }}</p>
            </section>
            
            <section>
                <h2>Profesional</h2>
                <p><strong>Nombre:</strong> {{ turno.profesional.usuario.get_full_name }}</p>
                <p><strong>Email:</strong> {{ turno.profesional.usuario.email }}</p>
                <p><strong>Teléfono:</strong> {{ turno.profesional.usuario.telefono }}</p>
                <p><strong>Calificación:</strong> {{ turno.profesional.calificacion_promedio }}/5.0</p>
            </section>
            
            <section>
                <h2>Información de Pago</h2>
                <p><strong>Precio:</strong> <span class="precio">${{ turno.precio_final }}</span></p>
                {% if turno.pago %}
                    <p><strong>Estado del Pago:</strong> {{ turno.pago.get_estado_display }}</p>
                    <p><strong>Método de Pago:</strong> {{ turno.pago.get_metodo_display }}</p>
                {% endif %}
            </section>
            
            {% if turno.calificacion %}
                <section>
                    <h2>Calificación</h2>
                    <p><strong>Puntuación:</strong> {{ turno.calificacion.puntuacion }}/5</p>
                    {% if turno.calificacion.comentario %}
                        <p><strong>Comentario:</strong> {{ turno.calificacion.comentario }}</p>
                    {% endif %}
                    <p><strong>Fecha:</strong> {{ turno.calificacion.fecha_calificacion|date:"d/m/Y H:i" }}</p>
                </section>
            {% endif %}
        </div>
        
        <div class="turno-acciones">
            <a href="{% url 'turnos:historial_turnos' %}" class="btn btn-secondary">⬅ Volver</a>
            
            {% if turno.estado == 'pendiente' %}
                {% if user.is_cliente and user.perfil_cliente == turno.cliente %}
                    <a href="{% url 'turnos:modificar_turno' turno.id %}" class="btn btn-warning">Modificar</a>
                    <a href="{% url 'turnos:cancelar_turno' turno.id %}" class="btn btn-danger">Cancelar</a>
                {% elif user.is_profesional and user.perfil_profesional == turno.profesional %}
                    <a href="{% url 'turnos:confirmar_turno' turno.id %}" class="btn btn-success">Confirmar</a>
                {% endif %}
            {% endif %}
            
            {% if turno.estado == 'completado' and user.is_cliente and user.perfil_cliente == turno.cliente %}
                {% if not turno.calificacion %}
                    <a href="{% url 'turnos:calificar_turno' turno.id %}" class="btn btn-primary">Calificar</a>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
