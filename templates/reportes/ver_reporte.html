{% extends 'base.html' %}

{% block title %}{{ reporte.titulo }} - ServiHogar{% endblock %}

{% block content %}
<div class="page-container">
    <div class="reporte-header">
        <h1>{{ reporte.titulo }}</h1>
        <p class="reporte-meta">
            <strong>Tipo:</strong> {{ reporte.get_tipo_display }} | 
            <strong>Generado:</strong> {{ reporte.fecha_generacion|date:"d/m/Y H:i" }} | 
            <strong>Por:</strong> {{ reporte.generado_por.get_full_name }}
        </p>
    </div>
    
    <div class="reporte-contenido">
        {% if reporte.tipo == 'preferencias_cliente' %}
            <section class="reporte-seccion">
                <h2>Resumen General</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>{{ datos.total_clientes }}</h3>
                        <p>Total de Clientes</p>
                    </div>
                    <div class="stat-card">
                        <h3>{{ datos.promedio_turnos_por_cliente|floatformat:2 }}</h3>
                        <p>Turnos Promedio por Cliente</p>
                    </div>
                </div>
            </section>
            
            <section class="reporte-seccion">
                <h2>Servicios Más Solicitados</h2>
                <table class="tabla-reporte">
                    <thead>
                        <tr>
                            <th>Servicio</th>
                            <th>Categoría</th>
                            <th>Total Solicitudes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for servicio in datos.servicios_populares %}
                            <tr>
                                <td>{{ servicio.servicio__nombre }}</td>
                                <td>{{ servicio.servicio__categoria__nombre }}</td>
                                <td>{{ servicio.total }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
            
            <section class="reporte-seccion">
                <h2>Categorías Más Populares</h2>
                <table class="tabla-reporte">
                    <thead>
                        <tr>
                            <th>Categoría</th>
                            <th>Total Solicitudes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for categoria in datos.categorias_populares %}
                            <tr>
                                <td>{{ categoria.servicio__categoria__nombre }}</td>
                                <td>{{ categoria.total }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
            
            <section class="reporte-seccion">
                <h2>Clientes Más Activos</h2>
                <table class="tabla-reporte">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Total Turnos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cliente in datos.clientes_activos %}
                            <tr>
                                <td>{{ cliente.cliente__usuario__first_name }} {{ cliente.cliente__usuario__last_name }}</td>
                                <td>{{ cliente.total_turnos }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
            
        {% elif reporte.tipo == 'ingresos' %}
            <section class="reporte-seccion">
                <h2>Total de Ingresos</h2>
                <div class="stat-card-large">
                    <h3>${{ datos.total_ingresos }}</h3>
                    <p>Período: {{ datos.periodo }}</p>
                </div>
            </section>
            
        {% else %}
            <section class="reporte-seccion">
                <h2>Datos del Reporte</h2>
                <pre>{{ datos|pprint }}</pre>
            </section>
        {% endif %}
    </div>
    
    <div class="reporte-acciones">
        <a href="{% url 'reportes:menu_reportes' %}" class="btn btn-secondary">⬅ Volver al Menú</a>
        <a href="{% url 'reportes:listar_reportes' %}" class="btn btn-info">Ver Todos los Reportes</a>
    </div>
</div>

<style>
.reporte-header {
    background-color: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin-bottom: 2rem;
}

.reporte-meta {
    color: var(--gray-text);
    margin-top: 1rem;
}

.reporte-contenido {
    background-color: var(--white);
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
}

.reporte-seccion {
    margin-bottom: 3rem;
}

.reporte-seccion h2 {
    margin-bottom: 1.5rem;
    color: var(--primary-color);
    border-bottom: 2px solid var(--light-bg);
    padding-bottom: 0.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.stat-card {
    background-color: var(--light-bg);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    text-align: center;
}

.stat-card h3 {
    font-size: 2.5rem;
    color: var(--secondary-color);
    margin-bottom: 0.5rem;
}

.stat-card-large {
    background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
    color: var(--white);
    padding: 3rem;
    border-radius: var(--border-radius);
    text-align: center;
}

.stat-card-large h3 {
    font-size: 3.5rem;
    margin-bottom: 1rem;
}

.tabla-reporte {
    width: 100%;
    border-collapse: collapse;
}

.tabla-reporte th,
.tabla-reporte td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--light-bg);
}

.tabla-reporte th {
    background-color: var(--primary-color);
    color: var(--white);
    font-weight: 600;
}

.tabla-reporte tr:hover {
    background-color: var(--light-bg);
}

.reporte-acciones {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
}
</style>
{% endblock %}
